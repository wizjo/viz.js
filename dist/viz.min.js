/*! viz.js 15-10-2014 */
var viz={version:"1.0.0"};!function(){var a=!1,b=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(c){function d(){!a&&this.init&&this.init.apply(this,arguments)}var e=this.prototype;a=!0;var f=new this;a=!1;for(var g in c)f[g]="function"==typeof c[g]&&"function"==typeof e[g]&&b.test(c[g])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);return this._super=c,d}}(g,c[g]):c[g];return d.prototype=f,d.constructor=d,d.extend=arguments.callee,d}}();var Chart=Class.extend({defaults:{height:400,width:600,xLeftMargin:50,xRightMargin:30,yMargin:30},init:function(a,b){$.extend(!0,this,this.defaults,b)}}),BarChart=Chart.extend({init:function(a,b,c){this._super(a,c);var d=this;this.width=this.width||400,this.space=this.space||20,this.leftMargin=this.leftMargin||5,this.rightMargin=this.rightMargin||10,this.topMargin=this.topMargin||5,this.bottomMargin=this.bottomMargin||5,this.barWidth=this.barWidth||5,this.baseline=this.baseline||"right",this.stacked=this.stacked||!1,this.fill=this.fill||d3.scale.category10(),this.addRules=this.addRules||!0,this.useTipsy=this.useTipsy||!1,this.formatter=this.formatter||".2f",this.series=this.series||$.map(b.values,function(a,b){return[b]}),b.values=d3.layout.stack()($.map(b.values,function(a){return[a]})),this.height=(b.labels.length-1)*this.space+(this.stacked?1:this.series.length)*b.labels.length*this.barWidth+this.bottomMargin,this.max=this.max||d3.max($.map(b.values,function(a){return d3.max($.map(a,function(a){return d.stacked?a.y0+a.y:a.y}))})),this.min=this.min||d3.min($.map(b.values,function(a){return d3.min($.map(a,function(a){return d.stacked?a.y0+a.y:a.y}))})),this.hScale="left"===d.baseline?this.hScale||d3.scale.linear().domain([d.min<0?d.min:0,d.max]).range([0,d.width-d.leftMargin-d.rightMargin]):this.hScale||d3.scale.linear().domain([d.min<0?d.min:0,d.max]).range([d.width-d.leftMargin-d.rightMargin,0]),this.vis=d3.select(a).append("svg:svg").attr("class","bar_chart").attr("width",this.width).attr("height",this.height),this.g=this.vis.append("svg:g").attr("transform","translate("+this.leftMargin+", "+this.topMargin+")"),(this.addRules||this.numRules&&this.numRules>0)&&this.g.selectAll("line.rule").data(function(){var a=d.hScale.ticks(d.numRules);return $.map(a,function(b,c){return c<a.length?[b]:void 0})}).enter().append("line").attr("class","rule").attr("x1",this.hScale).attr("x2",this.hScale).attr("y1",0).attr("y2",this.height).style("stroke",function(a,b){return b>0?"#ccc":"#333"}).attr("stroke-width",function(a,b){return b>0?.6:1}),$.each(b.values,function(a,b){d.addBar(a,b)}),this.useTipsy&&$(a+" rect").tipsy({gravity:"right"==d.baseline?"e":"w",title:function(){var a=this.__data__;return d3.format(d.formatter)(a.y)}})},addBar:function(a,b){self=this,this.g.selectAll("rect.series_"+a).data(b).enter().append("svg:rect").attr("class",function(){return"series_"+a}).attr("x",function(a){return self.hScale("left"===self.baseline?self.stacked?a.y0:0:self.stacked?a.y+a.y0:a.y)}).attr("y",function(b,c){return(self.stacked?0:parseInt(a)*self.barWidth)+c*((self.stacked?1:self.series.length)*self.barWidth+self.space)}).attr("height",self.barWidth).attr("width",function(a){return"left"===self.baseline?self.hScale(a.y):self.hScale(0)-self.hScale(a.y)}).attr("stroke","none").attr("fill",function(b,c){return self.fill("bar_"+a+"_"+c)})}}),BulletChart=Chart.extend({init:function(a,b,c){this._super(a,c);var d=this;this.selector=a,this.width=this.width||500,this.height=this.height||45,this.leftMargin=this.leftMargin||100,this.rightMargin=this.rightMargin||5,this.topMargin=this.topMargin||2,this.bottomMargin=this.bottomMargin||2,this.title=this.title||!1,this.subtitle=this.subtitle||!1,this.fill=this.fill||d3.scale.category10(),this.hover_events=this.hover_events||!1,this.hover_label_color=this.hover_label_color||"#333",this.chart=this.chart||d3.chart.bullet().width(this.width-this.leftMargin-this.rightMargin).height(this.height-this.topMargin-this.bottomMargin),this.vis=d3.select(a).selectAll("svg").data(b).enter().append("svg:svg").attr("class","bullet").attr("id",function(a,b){return"chart-"+b}).attr("width",this.width).attr("height",this.height).append("svg:g").attr("transform","translate("+this.leftMargin+", "+this.topMargin+")").call(this.chart),this.t=d3.select(a).selectAll("svg.bullet").attr("text-anchor","end"),this.hover_idx=-1,this.title&&this.addTitle(),this.subtitle&&this.addSubTitle(),this.annotation&&this.addAnnotation(),this.hover_events&&(this.addChartTips(),this.vis.on("mouseover",function(a,b){return d.mouseover(a,b)}).on("mouseout",function(a,b){return d.mouseout(a,b)}))},addTitle:function(){this.t.append("svg:text").attr("class","title").attr("transform","translate("+.95*this.leftMargin+", "+(this.height-this.topMargin-this.bottomMargin)/2+")").text(function(a){return a.title})},addSubTitle:function(){this.t.append("svg:text").attr("class","subtitle").attr("transform","translate("+.7*this.leftMargin+", "+(this.height-this.topMargin-this.bottomMargin+4)/2+")").attr("dy","1em").text(function(a){return a.subtitle})},addAnnotation:function(){this.t.append("svg:text").attr("class","annotation").attr("transform","translate("+.95*this.leftMargin+", "+(this.height-this.topMargin-this.bottomMargin+6)/2+")").attr("dy","1em").text(function(a){return"("+a.annotation+")"})},addChartTips:function(){self=this,this.t.append("svg:text").attr("class","tip").attr("dy",".8em").attr("transform",function(a){return"translate("+(self.leftMargin+(self.width-self.leftMargin-self.rightMargin)/a.ranges[a.ranges.length-1]*a.measures[0])+", "+(self.height-self.topMargin-self.bottomMargin)/2+")"}).text(function(a){return a.measures[0]}).attr("fill","none")},mouseover:function(a,b){var c=this;this.hover_idx=b,d3.select(this.selector).selectAll("text.tip").attr("fill",function(a,b){return c.hover_idx==b?c.hover_label_color:"none"}),d3.select(this.selector).selectAll("rect.measure").attr("stroke",function(a,b){return c.hover_idx==b?"#FFF":"none"}).attr("stroke-width","2px"),this.hover_idx=-1},mouseout:function(a,b){this.hover_idx=b,d3.select(this.selector).selectAll("text.tip").attr("fill","none"),d3.select(this.selector).selectAll("rect.measure").attr("stroke","none"),this.hover_idx=-1}}),ColumnChart=Chart.extend({init:function(a,b,c){this._super(a,c);var d=this;this.height=this.height||400,this.space=this.space||20,this.leftMargin=this.leftMargin||5,this.rightMargin=this.rightMargin||10,this.topMargin=this.topMargin||5,this.bottomMargin=this.bottomMargin||5,this.barWidth=this.barWidth||5,this.baseline=this.baseline||"bottom",this.stacked=this.stacked||!1,this.numRules=this.numRules||1,this.yaxis_position=this.yaxis_position||"left",this.ynumTicks=this.ynumTicks||10,this.yAxisMargin=this.yAxisMargin||30,this.show_labels=this.show_labels||!1,this.label_position=this.label_position||"vertical",this.useTipsy=this.useTipsy||!1,this.formatter=this.formatter||".2f",this.series=this.series||$.map(b.values,function(a,b){return[b]}),b.values=d3.layout.stack()($.map(b.values,function(a){return[a]})),this.width=(b.labels.length-1)*this.space+(this.stacked?1:this.series.length)*b.labels.length*this.barWidth+this.leftMargin+this.rightMargin+this.yAxisMargin,this.max=this.max||d3.max($.map(b.values,function(a){return d3.max($.map(a,function(a){return d.stacked?a.y0+a.y:a.y}))})),this.min=this.min||d3.min($.map(b.values,function(a){return d3.min($.map(a,function(a){return d.stacked?a.y0+a.y:a.y}))})),this.vScale="top"===d.baseline?this.vScale||d3.scale.linear().domain([d.min<0?d.min:0,d.max]).range([0,d.height-d.topMargin-d.bottomMargin]):this.vScale||d3.scale.linear().domain([d.min<0?d.min:0,d.max]).range([d.height-d.topMargin-d.bottomMargin,0]),this.yAxis=d3.svg.axis().scale(this.vScale).ticks(this.ynumTicks).tickFormat(function(a){var b=d3.format(",0d");return 0==a?0:a>1?b(a):a>=.01?n.toPrecision(2):parseFloat(n.toPrecision(2)).toExponential()}).orient(this.yaxis_position),this.vis=d3.select(a).append("svg:svg").attr("class","column_chart").attr("width",this.width).attr("height",this.height),this.g=this.vis.append("svg:g").attr("transform","translate("+("left"===this.yaxis_position?this.yAxisMargin+this.leftMargin:this.leftMargin)+", "+this.topMargin+")"),$.each(b.values,function(a,b){d.addBar(a,b)}),this.numRules>0&&this.g.selectAll("line.rule").data(function(){var a=d.vScale.ticks(d.numRules);return a.slice(0,d.numRules)}).enter().append("svg:line").attr("class",function(a,b){return b>0?"rule":"rule_first"}).attr("y1",this.vScale).attr("y2",this.vScale).attr("x1",-this.leftMargin).attr("x2",this.width),"none"!==this.yaxis_position&&this.g.append("svg:g").attr("class","y axis").attr("transform",function(){return"left"===d.yaxis_position?"translate(-"+d.leftMargin+", 0)":"translate("+(d.width-d.rightMargin)+", 0)"}).call(this.yAxis),this.show_labels&&this.g.selectAll("text.label").data(b.labels).enter().append("svg:text").attr("class","label").attr("x",function(a,b){return(d.stacked?0:parseInt(key)*d.barWidth)+b*((d.stacked?1:d.series.length)*d.barWidth+d.space)}).attr("y",this.height-this.topMargin-this.bottomMargin).attr("text-anchor","end").attr("transform",function(a,b){return"translate("+(d.stacked?.55:1.05)*d.barWidth+", "+("vertical"==d.label_position?5:8)+")rotate("+("vertical"==d.label_position?"-90":"-45")+" "+((d.stacked?0:parseInt(key)*d.barWidth)+b*((d.stacked?1:d.series.length)*d.barWidth+d.space))+" "+(d.height-d.topMargin-d.bottomMargin)+")"}).text(function(a){return a}),this.useTipsy&&$(a+" rect").tipsy({gravity:"sw",title:function(){var a=this.__data__;return d3.format(d.formatter)(a.y)}})},addBar:function(a,b){self=this,this.g.selectAll("rect.series_"+a).data(b).enter().append("svg:rect").attr("class",function(){return"series_"+a}).attr("y",function(a){return self.vScale("top"===self.baseline?self.stacked?a.y0:0:self.stacked?a.y0+a.y:a.y)}).attr("x",function(b,c){return(self.stacked?0:parseInt(a)*self.barWidth)+c*((self.stacked?1:self.series.length)*self.barWidth+self.space)}).attr("width",self.barWidth).attr("height",function(a){return"top"===self.baseline?self.vScale(a.y):self.vScale(0)-self.vScale(a.y)}).attr("fill",function(b,c){return self.fill?self.fill("bar_"+a+"_"+c):"none"})}}),ConcentricChart=Chart.extend({init:function(a,b,c){this._super(a,c);var d=this;this.align=this.align||"center",this.margin=this.margin||5,this.fill=this.fill||d3.scale.category10(),this.rScale=this.rScale||d3.scale.sqrt().domain([0,1]).range([0,(this.height-2*this.margin)/2]),this.vis=d3.select(a).append("svg:svg").attr("width",this.width).attr("height",this.height),this.g=this.vis.append("svg:g").attr("transform","translate("+this.margin+", "+this.margin+")"),$.each(b,function(a,b){d.addCircle(a,b)})},addCircle:function(a,b){var c=this;this.g.append("svg:circle").attr("class","circle "+a).attr("cx",function(){switch(c.align){case"left":return c.rScale(b);case"right":return 2*c.rScale(1)-c.rScale(b);case"center":return c.rScale(1);case"up":return c.rScale(1);case"down":return c.rScale(1);default:return c.rScale(1)}}).attr("cy",function(){switch(c.align){case"left":return c.rScale(1);case"right":return c.rScale(1);case"center":return c.rScale(1);case"up":return c.rScale(b);case"bottom":return 2*c.rScale(1)-c.rScale(b);default:return c.rScale(1)}}).attr("stroke","none").attr("fill",this.fill(a)).attr("r",this.rScale(b))}}),FilledSeries=Chart.extend({init:function(a,b,c){this._super(a,c);var d=this;this.startX=this.startX||d3.min($.map(b,function(a){return a[0].x})),this.endX=this.endX||d3.max($.map(b,function(a){return a[a.length-1].x})),this.max=this.max||d3.max($.map(b,function(a){return d3.max($.map(a,function(a){return a.y}))})),this.min=this.min||d3.min($.map(b,function(a){return d3.min($.map(a,function(a){return a.y}))})),this.x=this.x||d3.scale.linear().domain([this.startX,this.endX]).range([0+this.xLeftMargin,this.width-this.xLeftMargin-this.xRightMargin]),this.y=this.y||d3.scale.linear().domain([this.min<0?this.min:0,this.max]).range([0+this.yMargin,this.height-this.yMargin]),this.yAxisScale=this.yAxisScale||d3.scale.linear().domain([this.min<0?this.min:0,this.max]).range([this.height-this.yMargin,0+this.yMargin]),this.xNumTicks=this.xNumTicks||6,this.yNumTicks=this.yNumTicks||4,this.fill=this.fill||d3.scale.category10(),this.drawDots=this.drawDots||!1,this.useTipsy=this.useTipsy||!1,this.formatter=this.formatter||".2f",this.vis=d3.select(a).append("svg:svg").attr("class","filled_series").attr("width",this.width).attr("height",this.height),this.g=this.vis.append("svg:g").attr("transform","translate(0, "+this.height+")"),this.line=this.line||d3.svg.line().x(function(a){return d.x(d.xLineTransform&&d.xLineTransform(a.x)||a.x)}).y(function(a){return-1*d.y(d.yLineTransform&&d.yLineTransform(a.y)||a.y)}),this.area=this.area||d3.svg.area().x(function(a){return d.x(d.xLineTransform&&d.xLineTransform(a.x)||a.x)}).y0(function(a){return-1*d.y(a.y0)}).y1(function(a){return-1*d.y(d.yLineTransform&&d.yLineTransform(a.y)||a.y)}),this.xAxis=this.xAxis||d3.svg.axis().scale(this.x).ticks(this.xNumTicks).orient("bottom"),this.vis.append("svg:g").attr("class","x axis").attr("transform","translate(0,"+(this.height-this.yMargin)+")").call(this.xAxis),this.yAxis=this.yAxis||d3.svg.axis().scale(this.yAxisScale).ticks(d.yNumTicks).tickFormat(function(a){var b=d3.format(",0d");return 0==a?0:a>1?b(a):a>=.01?a.toPrecision(2):parseFloat(a.toPrecision(2)).toExponential()}).orient("left"),this.vis.append("svg:g").attr("class","y axis").attr("transform","translate("+this.xLeftMargin+", 0)").call(this.yAxis),this.rightAxis&&(this.rightAxis=this.rightAxis||d3.svg.axis().scale(d3.scale.linear().domain([0,d.max]).range([this.height-this.yMargin,0+this.yMargin])).ticks(this.yNumTicks).orient("right"),this.vis.append("svg:g").attr("class","y axis right").attr("transform","translate("+(this.width-this.xLeftMargin-this.xRightMargin)+", 0)").call(this.rightAxis));var e=$.map(b.bottom,function(a,c){return{x:c,y0:a.y,y:b.top[c].y}});d.addArea("top",e),$.each(b,function(a,b){d.addLine(a,b),d.drawDots&&(d.addDots(a,b),d.useTipsy||d.addLabels(a,b))}),this.useTipsy&&$(a+" svg circle").tipsy({gravity:"sw",title:function(){var a=this.__data__;return d3.format(d.formatter)(a.y)}})},addLine:function(a,b){this.g.append("svg:path").attr("d",this.line(b)).attr("class","line "+a).attr("stroke",this.fill(a)).attr("fill","none")},addArea:function(a,b){this.g.append("svg:path").attr("class","area "+a).attr("d",this.area(b)).attr("fill",this.fill(a)).attr("fill-opacity",this.fillOpacity||.3)},addDots:function(a,b){var c=this;this.g.selectAll("circle.series_"+a).data(b).enter().append("svg:circle").attr("class","series_"+a).attr("cx",function(a){return c.x(c.xLineTransform&&c.xLineTransform(a.x)||a.x)}).attr("cy",function(a){return-1*c.y(c.yLineTransform&&c.yLineTransform(c.stacked?a.y+a.y0:a.y)||c.stacked?a.y+a.y0:a.y)}).attr("r",this.dot_radius).attr("fill",this.fill(a))}}),ForceDirected=Chart.extend({init:function(a,b,c){this._super(a,c);this.width=this.width||1200,this.height=this.height||1e3,this.leftMargin=this.leftMargin||10,this.rightMargin=this.rightMargin||10,this.topMargin=this.topMargin||10,this.bottomMargin=this.bottomMargin||10,this.minWidthValue=this.minWidthValue||d3.min($.map(b.links,function(a){return a.value})),this.maxWidthValue=this.maxWidthValue||d3.max($.map(b.links,function(a){return a.value})),this.width_s=d3.scale.linear().domain([this.minWidthValue,this.maxWidthValue]).range([this.minEdgeWidth,this.maxEdgeWidth]),this.borderScale&&(this.minBorderValue=this.minBorderWidth||d3.min($.map(b.nodes,function(a){return a.border_width})),this.maxBorderValue=this.maxBorderWidth||d3.max($.map(b.nodes,function(a){return a.border_width})),this.border_s=d3.scale.linear().domain([this.minBorderValue,this.maxBorderValue]).range([this.minBorderWidth,this.maxBorderWidth])),this.minSizeValue=this.minSizeValue||d3.min($.map(b.nodes,function(a){return a.size})),this.maxSizeValue=this.maxSizeValue||d3.max($.map(b.nodes,function(a){return a.size})),this.size_s=d3.scale.linear().domain([this.minSizeValue,this.maxSizeValue]).range([this.minNodeRadius,this.maxNodeRadius]),this.nodeFill=this.nodeFill||d3.scale.category20b(),this.edgeColor=this.edgeColor||d3.scale.category20b(),this.edgeType=this.edgeType||"bezier",this.directed=this.directed||!1,this.vis=d3.select(a).append("svg:svg").attr("class","force_directed").attr("width",this.width).attr("height",this.height),this.force=d3.layout.force().gravity(.8).charge(-200).distance(d3.max([this.width,this.height])/2).nodes(b.nodes).links(b.links).size([this.width-this.leftMargin-this.rightMargin,this.height-this.topMargin-this.bottomMargin]).start(),this.links=this.vis.selectAll("link").data(b.links),this.nodes=this.vis.selectAll("g.node").data(b.nodes),this.markers=this.directed?this.vis.append("svg:defs").selectAll("marker").data(b.links):null,this.directed&&this.drawMarkers(),this.drawNodesLinks()},drawEdge:function(a){switch(this.edgeType){case"bezier":return"M"+a.source.x+","+a.source.y+" Q"+(a.source.x+a.target.x)/2+","+(a.source.size>=a.target.size?a.source.y+10:a.target.y-10)+" "+a.target.x+","+a.target.y;case"arc":return"M "+a.source.x+","+a.source.y+" A"+a.target.x+","+a.target.y+" 0 "+(a.source.size>=a.target.size?"0,0":"0,1")+a.target.x+","+a.target.y;case"straight":return"M "+a.source.x+" "+a.source.y+" L "+a.target.x+" "+a.target.y;default:return"M"+a.source.x+","+a.source.y+" Q"+(a.source.x+a.target.x)/2+","+(a.source.size>=a.target.size?a.source.y+10:a.target.y-10)+" "+a.target.x+","+a.target.y}},drawMarkers:function(){self=this,this.markers.enter().append("svg:marker").attr("id",function(a,b){return"arrow-"+b}).attr("viewBox","0 -5 10 10").attr("refX",function(a){return self.width_s(a.value)}).attr("refY",0).attr("orient","auto").attr("fill",function(a){return self.nodeFill(a.source)}).attr("fill-opacity",.6).append("svg:path").attr("d","M0,-5L10,0L0,5 Z")},drawNodesLinks:function(){self=this,this.links.enter().append("svg:path").attr("d",function(a){return self.drawEdge(a)}).attr("stroke-width",function(a){return self.width_s(a.value)}).attr("stroke",function(a){return self.edgeColor(a)}).attr("stroke-opacity",.6).attr("fill","none").attr("marker-end",function(a,b){return self.directed?"url(#arrow-"+b+")":"none"}),this.nodes.enter().append("svg:g").attr("class","node").call(this.force.drag),this.nodes.append("svg:circle").attr("r",function(a){return self.size_s(a.size)}).attr("fill",function(a){return self.nodeFill(a)}).attr("opacity",.8),this.nodes.append("svg:text").attr("class","name").text(function(a){return a.name}),this.nodes.append("svg:text").attr("class","value").attr("text-anchor","middle").attr("dy","-.3em").attr("fill","none").text(function(a){return a.size}),this.vis.style("opacity",1e-6).transition().duration(1e3).style("opacity",1),this.force.on("tick",function(){self.links.attr("d",function(a){return self.drawEdge(a)}),self.nodes.attr("transform",function(a){return"translate("+a.x+","+a.y+")"})})}}),FunnelColumnChart=Chart.extend({init:function(a,b,c){this._super(a,c);var d=this;this.height=this.height||400,this.space=this.space||20,this.leftMargin=this.leftMargin||5,this.rightMargin=this.rightMargin||10,this.topMargin=this.topMargin||5,this.baseline=this.baseline||"bottom",this.stacked=this.stacked||!1,this.delay&&(this.delay.enabled=this.delay.enabled||!1,this.delay.unit=this.delay.unit||"",this.delay.average=this.delay.average||null),this.numRules=this.numRules||1,this.yaxis_position=this.yaxis_position||"left",this.ynumTicks=this.ynumTicks||10,this.yAxisMargin=this.yAxisMargin||30,this.show_labels=this.show_labels||!1,this.label_position=this.label_position||"vertical",this.label_class=this.label_class||"",this.useTipsy=this.useTipsy||!1,this.formatter=this.formatter||".2f",this.unit=this.unit||"total",this.lineStrokeColor=this.lineStrokeColor||"#EBEBEB",this.lineStrokeWidth=this.lineStrokeWidth||1.5,this.fill=this.fill||"#77c5d5",this.benchmark&&(this.benchmark.enabled=this.benchmark.enabled||!1,this.benchmark.fill=this.benchmark.fill||"#AA4643",this.benchmark.time=this.benchmark.time||""),this.legend&&(this.legend.enabled=this.legend.enabled||!1,this.legend.position=this.legend.position||"right"),this.series=this.series||$.map(b.values,function(a,b){return[b]}),b.values=d3.layout.stack()($.map(b.values,function(a){return[a]}));var e=b.values[0].length>4?b.values[0].length:b.values[0].length+.5;this.barWidth=$(window).width()/e-2*this.space,this.barWidth<0&&console.log("'space' option is too large for the number of bars given!"),this.arrowHeight=20+35*(b.values[0][1].content.length+1),this.arrowWidth=d.barWidth+this.space/2,this.bottomMargin=this.arrowHeight+this.bottomMargin||this.arrowHeight,this.width=b.values[0].length*(this.barWidth+d.space)+this.leftMargin+this.rightMargin+this.yAxisMargin,this.max=this.max||d3.max($.map(b.values,function(a){return d3.max($.map(a,function(a){return d.stacked?a.y0+a.y:a.y}))})),this.min=this.min||d3.min($.map(b.values,function(a){return d3.min($.map(a,function(a){return d.stacked?a.y0+a.y:a.y}))})),this.vScale=this.vScale||d3.scale.linear().domain([d.min<0?d.min:0,d.max]).range([d.height-d.topMargin-d.bottomMargin,0]),this.yAxis=d3.svg.axis().scale(this.vScale).ticks(this.ynumTicks).tickFormat(function(a){var b=d3.format(",0d");return 0==a?"0%":a>1?b(a)+"%":a>=.01?n.toPrecision(2)+"%":parseFloat(n.toPrecision(2)).toExponential()+"%"}).orient(this.yaxis_position);var f=document.createElement("div");if(f.setAttribute("margin-right",d.rightMargin),d.legend&&d.legend.enabled){var g='<div style="vertical-align:top;background-color:white;border-radius:10px;float:'+d.legend.position+';border-color:#EDEDED;border-style:solid;padding:17px;"><table>';if(d.benchmark&&d.benchmark.enabled){var h='<svg style="height:15px"><g><line x1=0 x2=35 y1=5 y2=5 style="stroke:'+d.benchmark.fill+';stroke-width:2;"></line><path d="m14 5 l4 4 l4 -4 l-4 -4 Z" style="fill:'+d.benchmark.fill+'"></path></g></svg>';g+='<tr><td style="width:40px">'+h+"</td>",g+=d.legend.benchmarkLabel?'<td style="padding-right:15px;color:'+d.benchmark.fill+'">'+d.legend.benchmarkLabel+"</td>":'<td style="padding-right:15px;color:'+d.benchmark.fill+'">'+d.legend.benchmarkLabel+"</td>"}g+='<td style="width:35px"><svg width=25 height=25><rect x=15 y=3 width=10 height=20 fill='+d.fill+' style="fill:'+d.fill+'"></rect><rect x=5 y=15 width=10 height=8 fill='+d.fill+' style="fill:'+d.fill+'"></rect></svg></td>',g+=d.legend.metricLabel?'<td style="color:'+d.fill+'" >'+d.legend.metricLabel+"</td>":'<td style="color:'+d.fill+'" >'+d.name+"</td>",g+="</tr></table></div>",$(f).append(g)}if(d.delay&&d.delay.enabled){if(d.delay.average)i=d.delay.average.toFixed(2);else{for(var i=0,j=0,k=0;k<b.values[0].length;k++)b.values[0][k].delay&&0!=b.values[0][k].delay&&(i+=new Number(b.values[0][k].delay),j++);i=0!=i?(i/j).toFixed(2):"N/A"}var l='<div style="vertical-align:top;background-color:#EDEDED;border-radius:10px;float:right;margin-right:15px;padding:12px;color:#4D4D4D">Average delay time between steps: <br /> <h1 style="color:#757575">'+i+" "+d.delay.unit+"s </h1></div>";$(f).append(l)}$(f).children().length>0&&$(a).append(f),this.vis=d3.select(a).append("svg:svg").attr("width",this.width).attr("height",this.height+this.arrowHeight),this.g=this.vis.append("svg:g").attr("transform","translate("+("left"===this.yaxis_position?this.yAxisMargin+this.leftMargin:this.leftMargin)+", "+this.topMargin+")"),this.numRules>0&&this.g.selectAll("line.rule").data(function(){var a=d.vScale.ticks(d.numRules);return a.slice(0,d.numRules)}).enter().append("svg:line").attr("class",function(a,b){return b>0?"rule":"rule_first"}).attr("y1",this.vScale).attr("y2",this.vScale).attr("x1",0).attr("x2",this.width-this.space-65).attr("style","stroke-width:"+d.lineStrokeWidth+";stroke:"+d.lineStrokeColor),$.each(b.values,function(b,c){d.addBar(b,c,a)}),"none"!==this.yaxis_position&&this.g.append("svg:g").attr("class","y axis").call(this.yAxis)},addBar:function(a,b,c){self=this;{var d=this.g.selectAll("rect.series_"+a).data(b).enter().append("svg:g");d.append("svg:rect").attr("class",function(){return"series_"+a}).attr("x",function(a,b){return b*self.barWidth+(b+1)*self.space}).attr("width",self.barWidth).style("fill",self.fill).attr("height",function(){var a=b[0].y;return self.vScale(0)-self.vScale(a)}).transition().duration(function(a,b){return 250*b}).attr("height",function(a){return self.vScale(0)-self.vScale(a.y)}).attr("y",function(a){return self.vScale(self.stacked?a.y0+a.y:a.y)})}if(self.benchmark&&self.benchmark.enabled){{d.append("svg:line").attr("x1",function(a,b){return(b+.5)*self.barWidth+(b+1)*self.space}).attr("x2",function(a,b){return(b+.5)*self.barWidth+(b+1)*self.space}).attr("y1",function(a){return self.vScale(a.benchmark)}).attr("y2",function(a){return self.vScale(a.benchmark)}).style("stroke",self.benchmark.fill).attr("stroke-width",2).transition().duration(function(a,b){return 250*(b+1)}).attr("x1",function(a,b){return(b+.25)*self.barWidth+(b+1)*self.space}).attr("x2",function(a,b){return(b+.75)*self.barWidth+(b+1)*self.space})}d.append("svg:path").attr("d",function(a,b){var c=(b+.5)*self.barWidth+(b+1)*self.space,d=self.vScale(a.benchmark);return"m"+(c-5)+" "+d+" l5 5 l5 -5 l-5 -5 Z"}).style("fill",self.benchmark.fill).attr("opacity",0).transition().duration(function(a,b){return 250*b}).attr("opacity",1)}var e=self.space,f=this.arrowHeight/(b[1].content.length+2),g="-"+self.space/3+" -"+self.space/3,h=d.append("svg:g").attr("transform",function(a,b){var c=b*self.barWidth+(b+1)*self.space,d=self.vScale(a.y0)+25;return"translate("+c+", "+d+")"});h.attr("opacity",0).transition().duration(function(a,b){return 350*b}).attr("opacity",1),h.append("svg:path").attr("d",function(a,c){var d="m"+g+" h"+self.arrowWidth+"l"+self.space/2+" "+self.arrowHeight/2+"  l-"+self.space/2+" "+self.arrowHeight/2+"  h-"+self.arrowWidth;return 0===c?d+="L"+g+" Z":c===b.length-1?"m"+g+" h"+(self.arrowWidth+self.space/2)+"v"+self.arrowHeight+" h-"+(self.arrowWidth+self.space/2)+" l"+self.space/2+" -"+self.arrowHeight/2+"  L"+g+" Z":d+=" l"+self.space/2+" -"+self.arrowHeight/2+"  L"+g+" Z"}).style("stroke",self.fill).attr("stroke-width",3).style("fill","#EDF7FF");var i=h.append("svg:text").attr("y",f);i.append("svg:tspan").attr("x",e).attr("font-weight","bold").attr("font-size",15).text(function(a){return a.title}),i.selectAll("text").data(function(a){return a.content}).enter().append("svg:tspan").attr("x",e).attr("dy",25).attr("font-size",13).text(function(a){return a}),d.on("mouseover",function(a,b){$($($(this).children()[3]).children()[0]).css("stroke","#696969"),$($(this).children()[0]).css("stroke-width",3),$($(this).children()[0]).css("stroke","#696969");var e=b>d[0].length/2?b:b+1,f=e*self.barWidth+(e+1)*self.space+self.leftMargin+self.yAxisMargin;b>d[0].length/2&&(f-=self.barWidth+2*self.space);var g=self.height-self.vScale(a.y)+self.arrowHeight,h="-o-transform:translate("+f+"px, -"+g+"px);-webkit-transform:translate("+f+"px, -"+g+"px);-ms-transform:translate("+f+"px, -"+g+"px);width:"+(self.barWidth-self.space/2)+"px;-moz-transform:translate("+f+"px, -"+g+"px)",i='<h3 style="color:black">'+a.title+'</h3><div style="margin-left:20px"><p><h4 style="display:inline">'+a.total+"</h4>  "+self.unit+"</p>";b>0&&(i+='<p><h4 style="display:inline">'+a.y+"</h4>% of initial "+self.unit+"</p>",a.delay&&(i+='<p style="display:inline">Averaged <h4 style="display:inline">'+a.delay+" "+self.delay.unit+"</h4> delay between this and the last step</p>"),a.benchmark&&(i+='<p style="color:'+self.benchmark.fill+';display:inline"> Has been <br /> </p> <h4 style="color:'+self.benchmark.fill+';display:inline">'+a.benchmark+'%</h4> <p style="color:'+self.benchmark.fill+';display:inline"> the last '+self.benchmark.time+" (benchmark) </p></div>",a.benchdelay&&(i+='<p style="color:'+self.benchmark.fill+'display:inline">Averaged <h4 style="color:'+self.benchmark.fill+'display:inline">'+a.delay+"</h4> delay between this and the last step in the last "+self.benchmark.time+"(benchmark delay)</p>")));var j='<div id="tooltip" style="'+h+'">'+i+"</div>";$(c).append(j),$("#tooltip").addClass(b>d[0].length/2?"afterarrow":"beforearrow")}),d.on("mouseout",function(){$($($(this).children()[3]).children()[0]).css("stroke",self.fill),$($(this).children()[0]).css("stroke-width",0),$($(this).children()[0]).css("stroke","none"),$("#tooltip").remove()})}}),GanttChart=Chart.extend({init:function(a,b,c){this._super(a,c);var d=this;this.width=this.width||1e3,this.leftMargin=this.leftMargin||10,this.rightMargin=this.rightMargin||10,this.topMargin=this.topMargin||10,this.bottomMargin=this.bottomMargin||10,this.barHeight=this.barHeight||20,this.height=this.height||b.length*(this.bottomMargin+this.barHeight)+this.topMargin+100,this.formatter=this.formatter||".2f",this.xNumTicks=this.xNumTicks||24,this.rowBackground=this.rowBackground||"#666",this.hover_idx=-1,this.vis=d3.select(a).append("svg:svg").attr("class","gantt_chart").attr("width",this.width).attr("height",this.height),$.each(b,function(a,b){d.addSeries(a,b)}),this.topAxis=this.topAxis||d3.svg.axis().scale(this.xScale).ticks(this.xNumTicks).orient("bottom"),this.vis.append("svg:g").attr("class","x axis").attr("transform","translate("+this.leftMargin+", "+this.topMargin/2+")").call(this.topAxis),this.bottomAxis=this.bottomAxis||d3.svg.axis().scale(this.xScale).ticks(this.xNumTicks).orient("top"),this.vis.append("svg:g").attr("class","x axis").attr("transform","translate("+this.leftMargin+", "+(this.height-2)+")").call(this.bottomAxis),$(a+" rect.series").tipsy({gravity:"e",html:!0,title:function(){var a=this.__data__;return a.label||d.label&&d.label(a)||null}})},addSeries:function(a,b){var c=this,d=this.vis.append("svg:g").attr("class","series "+b.id).attr("transform","translate("+this.leftMargin+", "+(this.topMargin+parseInt(a)*this.barHeight)+")");d.append("svg:rect").attr("class","row").attr("id","row-"+a).attr("x",-this.leftMargin).attr("y",0).attr("width",this.width-this.rightMargin).attr("height",this.barHeight).attr("fill",a%2==0?this.rowBackground:"none").attr("fill-opacity",.2);var e=d.selectAll("a.bar-href").data(b.values).enter().append("a").attr("xlink:href",function(a){return a.tipLink}).attr("class","bar-href");e.append("svg:rect").attr("class",function(a){return"series "+a.state}).attr("x",function(a){return c.xScale(c.xTransform(a.start_time))}).attr("y",0).attr("width",function(a){return c.xScale(c.xTransform(a.end_time))-c.xScale(c.xTransform(a.start_time))+8}).attr("height",this.barHeight).attr("fill",this.fill&&this.fill(b.id)||"none").on("mouseover",function(a,d){return c.mouseover(b.id,d)}).on("mouseout",function(a,d){return c.mouseout(b.id,d)}),d.selectAll("line.start").data(b.values).enter().append("svg:line").attr("transform","translate(0, -"+(this.topMargin+parseInt(a)*this.barHeight)+")").attr("class","highlight").attr("id",function(a,c){return"start"+b.id+"_"+c}).attr("x1",function(a){return c.xScale(c.xTransform(a.start_time))}).attr("x2",function(a){return c.xScale(c.xTransform(a.start_time))}).attr("y1",this.topMargin/2).attr("y2",this.height-2).attr("stroke","none"),d.selectAll("line.end").data(b.values).enter().append("svg:line").attr("transform","translate(0, -"+(this.topMargin+parseInt(a)*this.barHeight)+")").attr("class","highlight").attr("id",function(a,c){return"end"+b.id+"_"+c}).attr("x1",function(a){return c.xScale(c.xTransform(a.end_time))+8}).attr("x2",function(a){return c.xScale(c.xTransform(a.end_time))+8}).attr("y1",this.topMargin/2).attr("y2",this.height-2).attr("stroke","none"),d.append("svg:line").attr("class","baseline").attr("y1",this.barHeight-1).attr("y2",this.barHeight-1).attr("x1",0).attr("x2",this.width-this.leftMargin-this.rightMargin);var f=this.vis.append("svg:g").attr("class","labels").attr("transform","translate(0, "+(this.topMargin+parseInt(a)*this.barHeight)+")"),g=f.append("svg:text").attr("class","title").attr("transform","translate(0, "+this.topMargin/2+")").attr("text-anchor","start");
g.append("a").attr("xlink:href",b.titleLink),g.selectAll("a").append("svg:tspan").text(function(){return b.label})},mouseover:function(a,b){this.hover_idx=b,this.vis.select("line#start"+a+"_"+b).attr("stroke","#666"),this.vis.select("line#end"+a+"_"+b).attr("stroke","#666"),this.hover_idx=-1},mouseout:function(a,b){this.hover_idx=b,this.vis.select("line#start"+a+"_"+b).attr("stroke","none"),this.vis.select("line#end"+a+"_"+b).attr("stroke","none"),this.hover_idx=-1}}),LineChart=Chart.extend({init:function(a,b,c){this._super(a,c);var d=this;this.stacked=this.stacked||!1;var e=$.map(b,function(a){return[a]});e.length>1&&(b=d3.layout.stack()($.map(b,function(a){return[a]}))),this.startX=this.startX||d3.min($.map(b,function(a){return a[0].x})),this.endX=this.endX||d3.max($.map(b,function(a){return a[a.length-1].x})),this.max=this.max||d3.max($.map(b,function(a){return d3.max($.map(a,function(a){return d.stacked?a.y0+a.y:a.y}))})),this.min=this.min||d3.min($.map(b,function(a){return d3.min($.map(a,function(a){return d.stacked?a.y0+a.y:a.y}))})),this.x=this.x||d3.scale.linear().domain([this.startX,this.endX]).range([0+this.xLeftMargin,this.width-this.xLeftMargin-this.xRightMargin]),this.y=this.y||d3.scale.linear().domain([this.min<0?this.min:0,this.max]).range([0+this.yMargin,this.height-this.yMargin]),this.yAxisScale=this.yAxisScale||d3.scale.linear().domain([this.min<0?this.min:0,this.max]).range([this.height-this.yMargin,0+this.yMargin]),this.xNumTicks=this.xNumTicks||6,this.yNumTicks=this.yNumTicks||4,this.fill=this.fill||d3.scale.category10(),this.fillShades=this.fillShades||!1,this.drawDots=this.drawDots||!1,this.useTipsy=this.useTipsy||!1,this.formatter=this.formatter||",0d",this.useTipsy||(this.hover_idx=-1,this.dot_radius=this.dot_radius||5),this.vis=d3.select(a).append("svg:svg").attr("class","line_chart").attr("width",this.width).attr("height",this.height),this.g=this.vis.append("svg:g").attr("transform","translate(0, "+this.height+")"),this.line=this.line||d3.svg.line().x(function(a){return d.x(d.xLineTransform&&d.xLineTransform(a.x)||a.x)}).y(function(a){return-1*d.y(d.yLineTransform&&d.yLineTransform(d.stacked?a.y+a.y0:a.y)||d.stacked?a.y+a.y0:a.y)}),this.area=this.area||d3.svg.area().x(function(a){return d.x(d.xLineTransform&&d.xLineTransform(a.x)||a.x)}).y0(function(a){return-1*(d.stacked?d.y(a.y0):d.yMargin)}).y1(function(a){return-1*d.y(d.yLineTransform&&d.yLineTransform(d.stacked?a.y+a.y0:a.y)||d.stacked?a.y+a.y0:a.y)}),this.xAxis=this.xAxis||d3.svg.axis().scale(this.x).ticks(this.xNumTicks).orient("bottom"),this.vis.append("svg:g").attr("class","x axis").attr("transform","translate(0,"+(this.height-this.yMargin)+")").call(this.xAxis),this.yAxis=this.yAxis||d3.svg.axis().scale(this.yAxisScale).ticks(d.yNumTicks).tickFormat(function(a){var b=d3.format(",0d");return 0==a?0:a>1?b(a):a>=.01?a.toPrecision(2):parseFloat(a.toPrecision(2)).toExponential()}).orient("left"),this.vis.append("svg:g").attr("class","y axis").attr("transform","translate("+this.xLeftMargin+", 0)").call(this.yAxis),this.rightAxis&&(this.rightAxis=this.rightAxis||d3.svg.axis().scale(d3.scale.linear().domain([0,d.max]).range([this.height-this.yMargin,0+this.yMargin])).ticks(this.yNumTicks).orient("right"),this.vis.append("svg:g").attr("class","y axis right").attr("transform","translate("+(this.width-this.xLeftMargin-this.xRightMargin)+", 0)").call(this.rightAxis)),$.each(b,function(a,b){d.addLine(a,b),d.fillShades&&d.addArea(a,b),d.drawDots&&(d.addDots(a,b),d.useTipsy||d.addLabels(a,b))}),this.useTipsy&&$(a+" svg circle").tipsy({gravity:"sw",title:function(){var a=this.__data__;return d3.format(d.formatter)(a.y)}})},addLine:function(a,b){this.g.append("svg:path").attr("d",this.line(b)).attr("class","line "+a).attr("stroke",this.fill(a)).attr("fill","none")},addArea:function(a,b){this.g.append("svg:path").attr("class","area "+a).attr("d",this.area(b)).attr("fill",this.fill(a))},addDots:function(a,b){var c=this;this.g.selectAll("circle.series_"+a).data(b).enter().append("svg:circle").attr("class","series_"+a).attr("cx",function(a){return c.x(c.xLineTransform&&c.xLineTransform(a.x)||a.x)}).attr("cy",function(a){return-1*c.y(c.yLineTransform&&c.yLineTransform(c.stacked?a.y+a.y0:a.y)||c.stacked?a.y+a.y0:a.y)}).attr("r",this.dot_radius).attr("fill",this.fill(a)).on("mouseover",function(b,d){return c.mouseover(a,b,d)}).on("mouseout",function(b,d){return c.mouseout(a,b,d)})},addLabels:function(a,b){var c=this;this.g.selectAll("text.label_"+a).data(b).enter().append("svg:text").attr("class","label_"+a).attr("transform","translate(-"+2*this.dot_radius+", -"+1.5*this.dot_radius+")").attr("dx",function(a){return c.x(c.xLineTransform&&c.xLineTransform(a.x)||a.x)}).attr("dy",function(a){return-1*c.y(c.yLineTransform&&c.yLineTransform(c.stacked?a.y+a.y0:a.y)||c.stacked?a.y+a.y0:a.y)}).attr("fill","none").text(function(a){return d3.format(c.formatter)(a.y)})},mouseover:function(a,b,c){var d=this;this.hover_idx=c,this.g.selectAll("text.label_"+a).attr("fill",function(b,c){return c===d.hover_idx?d.fill(a):"none"}).attr("opacity",0).transition().duration(200).attr("opacity",1),this.hover_idx=-1},mouseout:function(a){this.g.selectAll("text.label_"+a).attr("fill","none")}}),PieChart=Chart.extend({init:function(a,b,c){this._super(a,c);var d=this;this.leftMargin=this.leftMargin||10,this.rightMargin=this.rightMargin||10,this.topMargin=this.topMargin||10,this.bottomMargin=this.bottomMargin||10,this.fill=this.fill||d3.scale.category10(),this.innerRadiusRatio=this.innerRadiusRatio||0,this.outerRadius=c.outerRadius||200,this.arc=this.arc||d3.svg.arc().innerRadius(this.innerRadiusRatio*this.outerRadius).outerRadius(this.outerRadius),this.highlight=this.highlight||d3.svg.arc().innerRadius(this.outerRadius).outerRadius(this.outerRadius+8),this.highlight_color=this.highlight_color||"#AEAEAE",this.formatter=this.formatter||".2f",this.vis=d3.select(a).attr("class","pie_chart"),this.hover_idx=-1;var e=$.map(b,function(a,b){return[b]});$.each(e,function(c,e){var f=b[e];d.addPie(c,e,f),$(a+" path.slice").tipsy({gravity:"sw",title:function(){var a=this.__data__,b=$.inArray(a.value,$.map(f,function(a){return a.value})),c=$.map(f,function(a){return a.label});return c[b]+": "+d3.format(d.formatter)(a.value)}})})},addPie:function(a,b,c){var d=this,e=this.vis.append("svg:svg").attr("class","svg "+b).attr("width",this.leftMargin+this.rightMargin+2*this.outerRadius).attr("height",this.topMargin+this.bottomMargin+2*this.outerRadius).append("svg:g").attr("class","pie "+b).attr("transform","translate("+(this.leftMargin+this.outerRadius)+", "+(this.topMargin+this.outerRadius)+")");e.selectAll("path.slice").data(function(){var a=$.map(c,function(a){return a.value});return d3.layout.pie()(a)}).enter().append("svg:path").attr("class","slice").attr("d",this.arc).attr("fill",function(a,b){return d.fill(b)}).on("mouseover",function(a,b){d.hover_idx=b,e.selectAll("path.highlight").attr("fill",function(a,b){return d.hover_idx==b?d.highlight_color:"none"}),d.idx=-1}).on("mouseout",function(){e.selectAll("path.highlight").attr("fill","none")}),e.selectAll("path.highlight").data(function(){var a=$.map(c,function(a){return a.value});return d3.layout.pie()(a)}).enter().append("svg:path").attr("class","highlight").attr("d",this.highlight).attr("fill","none"),e.selectAll("text.label").data(function(){var a=$.map(c,function(a){return a.value});return d3.layout.pie()(a)}).enter().append("svg:text").attr("class","label").attr("transform",function(a){return"translate("+d.arc.centroid(a)+")"}).attr("dy",".35em").attr("text-anchor","middle").attr("display",function(a){return a.endAngle-a.startAngle>Math.PI/6?null:"none"}).text(function(a){return a.value})}}),SparkBar=Chart.extend({init:function(a,b,c){this._super(a,c);var d=this;this.height=this.height||80,this.space=this.space||5,this.leftMargin=this.leftMargin||5,this.rightMargin=this.rightMargin||10,this.topMargin=this.topMargin||5,this.bottomMargin=this.bottomMargin||5,this.barWidth=this.barWidth||5,this.minBarHeight=this.minBarHeight||10,this.baseline=this.baseline||"bottom",this.stacked=this.stacked||!1,this.drawBaseline=this.drawBaseline||!1,this.addLinks=this.addLinks||!1,this.useTipsy=this.useTipsy||!1,this.formatter=this.formatter||".2f",this.series=this.series||$.map(b,function(a,b){return[b]}),this.values=$.map(b,function(a){return[a]}),this.stacked=this.stacked||!1,this.stacked&&(this.values=d3.layout.stack()($.map(b,function(a){return[a]}))),this.width=(this.values[0].length-1)*this.space+(this.stacked?1:this.series.length)*this.values[0].length*this.barWidth+this.leftMargin+this.rightMargin,this.max=this.max||d3.max($.map(this.values,function(a){return d3.max($.map(a,function(a){return d.stacked?a.y0+a.y:a.y}))})),this.min=this.min||d3.min($.map(this.values,function(a){return d3.min($.map(a,function(a){return d.stacked?a.y0+a.y:a.y}))})),this.vScale="top"===d.baseline?this.vScale||d3.scale.linear().domain([0,d.max]).range([d.topMargin,d.height-d.topMargin-d.bottomMargin-d.minBarHeight]):this.vScale||d3.scale.linear().domain([0,d.max]).range([d.height-d.topMargin-d.bottomMargin-d.minBarHeight,d.bottomMargin]),this.vis=d3.select(a).append("svg:svg").attr("class","spark_bar").attr("width",this.width).attr("height",this.height),this.g=this.vis.append("svg:g").attr("transform","translate("+("left"===this.yaxis_position?this.yAxisMargin+this.leftMargin:this.leftMargin)+", "+this.minBarHeight+")"),$.each(this.values,function(a,b){d.addLinks?d.addBarWithLink(a,b):d.addBar(a,b)}),this.drawBaseline&&this.vis.append("svg:line").attr("class","rule_first").attr("y1",this.height-1).attr("y2",this.height-1).attr("x1",this.leftMargin).attr("x2",this.width-this.rightMargin),this.useTipsy&&$(a+" rect").tipsy({html:!0,gravity:"bottom"==this.baseline?"sw":"ne",title:function(){var a=this.__data__;return a.label||d.label&&d.label(a)||null}})},addBarWithLink:function(a,b){self=this;var c=this.g.selectAll("a.bar-href").data(b).enter().append("a").attr("xlink:href",function(a){return(self.linkPrefix||"")+a.xlink}).attr("class","bar-href");c.append("svg:rect").data(b).attr("class",function(b){return"series_"+a+" "+b.state}).attr("y",function(a){return self.vScale("top"===self.baseline?self.stacked?a.y0:0:self.stacked?a.y0+a.y:a.y)}).attr("x",function(b,c){return(self.stacked?0:parseInt(a)*self.barWidth)+c*((self.stacked?1:self.series.length)*self.barWidth+self.space)}).attr("width",self.barWidth).attr("height",function(a){return"top"===self.baseline?self.vScale(a.y)+self.minBarHeight:self.vScale(0)-self.vScale(a.y)+self.minBarHeight}).attr("fill",function(b,c){return self.fill?self.fill("bar_"+a+"_"+c):null})},addBar:function(a,b){self=this,this.g.selectAll("rect.series_").data(b).enter().append("svg:rect").attr("class",function(b){return"series_"+a+" "+b.state}).attr("y",function(a){return self.vScale("top"===self.baseline?self.stacked?a.y0:0:self.stacked?a.y0+a.y:a.y)}).attr("x",function(b,c){return(self.stacked?0:parseInt(a)*self.barWidth)+c*((self.stacked?1:self.series.length)*self.barWidth+self.space)}).attr("width",self.barWidth).attr("height",function(a){return"top"===self.baseline?self.vScale(a.y)+self.minBarHeight:self.vScale(0)-self.vScale(a.y)+self.minBarHeight}).attr("fill",function(b,c){return self.fill?self.fill("bar_"+a+"_"+c):"none"})}}),SparkLine=Chart.extend({init:function(a,b,c){this._super(a,c);var d=this;this.stacked=this.stacked||!1,this.stacked&&(b=d3.layout.stack()($.map(b,function(a){return[a]}))),this.startX=this.startX||d3.min($.map(b,function(a){return a[0].x})),this.endX=this.endX||d3.max($.map(b,function(a){return a[a.length-1].x})),this.max=this.max||d3.max($.map(b,function(a){return d3.max($.map(a,function(a){return d.stacked?a.y0+a.y:a.y}))})),this.min=this.min||d3.min($.map(b,function(a){return d3.min($.map(a,function(a){return d.stacked?a.y0+a.y:a.y}))})),this.usedots=this.usedots||!0,this.uselabels=this.uselabels||!0,this.fillShades=this.fillShades||!1,this.x=this.x||d3.scale.linear().domain([this.startX,this.endX]).range([0+this.xLeftMargin,this.width-this.xLeftMargin-this.xRightMargin]),this.y=this.y||d3.scale.linear().domain([d.min,d.max]).range([0+this.yMargin,this.height-this.yMargin]),this.yAxisScale=this.yAxisScale||d3.scale.linear().domain([d.min>0?0:d.min,d.max]).range([this.height-this.yMargin,0+this.yMargin]),this.fill=this.fill||d3.scale.category10(),this.dot_radius=this.dot_radius||3,this.dot_xOffset=this.dot_xOffset||this.width/8,this.background_color=this.background_color||"#fff",this.vis=d3.select(a).append("svg:svg").attr("width",this.width).attr("height",this.height).style("background-color",this.background_color),this.g=this.vis.append("svg:g").attr("transform","translate(0, "+this.height+")"),this.line=this.line||d3.svg.line().x(function(a){return d.x(a.x)}).y(function(a){return-1*d.y(d.yLineTransform&&d.yLineTransform(this.stacked?a.y+a.y0:a.y)||this.stacked?a.y+a.y0:a.y)}),this.area=this.area||d3.svg.area().x(function(a){return d.x(a.x)}).y0(function(a){return-1*(d.stacked?d.y(a.y0):d.yMargin)}).y1(function(a){return-1*d.y(d.yLineTransform&&d.yLineTransform(this.stacked?a.y+a.y0:a.y)||this.stacked?a.y+a.y0:a.y)}),$.each(b,function(a,b){d.addLine(a,b),this.usedots&&d.addDot(a,b),this.uselabels&&d.addLabel(a,b),d.fillShades&&d.addArea(a,b)})},addLine:function(a,b){this.g.append("svg:path").attr("d",this.line(b)).attr("class","sparkline "+a).attr("stroke",this.fill(a)).attr("fill","none")},addDot:function(a,b){this.g.append("svg:circle").attr("class","sparkline_dot").attr("cx",this.x(b[b.length-1].x)).attr("cy",-1*this.y(b[b.length-1].y)).attr("r",this.dot_radius).attr("stroke","none").attr("fill",this.fill(a))},addLabel:function(a,b){this.g.append("svg:text").attr("class","latest_value").attr("x",this.x(b[b.length-1].x)).attr("y",-1*this.y(b[b.length-1].y)).attr("dx",-1*this.dot_xOffset).attr("text-anchor","left").text(b[b.length-1].y).attr("fill",this.fill(a))},addArea:function(a,b){this.g.append("svg:path").attr("class","area "+a).attr("d",this.area(b)).attr("fill",this.fill(a))}}),StreamGraph=Chart.extend({init:function(a,b,c){this._super(a,c);var d=this;this.width=this.width||1100,this.height=this.height||750,this.leftMargin=this.leftMargin||5,this.rightMargin=this.rightMargin||10,this.topMargin=this.topMargin||5,this.bottomMargin=this.bottomMargin||5,this.fill=this.fill||d3.scale.category10(),this.offset=this.offset||"silhouette",this.order=this.order||"inside-out",this.line_interpolate=this.line_interpolate||"linear",this.start_time=this.start_time||(new Date).valueOf()-864e5,this.interval=this.interval||6e4,this.label_names=$.map(b,function(a){return a.label}),this.series=$.map(b,function(a){return[$.map(a.vector,function(a,b){return{x:b,y:a}})]}),this.stream_data=d3.layout.stack().offset(this.offset).order(this.order)(this.series),this.aggregates=$.map(this.stream_data,function(a){var b=0;return $.each(a,function(a,c){b+=c.y}),b}),this.max_aggregates=d3.max(this.aggregates),this.mx=this.stream_data[0].length-1,this.my=1.02*d3.max(this.stream_data,function(a){return d3.max(a,function(a){return a.y0+a.y})}),this.hover_idx=-1,this.vis=d3.select(a).append("svg:svg").attr("class","streamgraph").attr("width",this.width).attr("height",this.height),this.area=d3.svg.area().x(function(a,b){return b*d.width/d.mx}).y0(function(a){return d.height-a.y0*d.height/d.my}).y1(function(a){return d.height-(a.y+a.y0)*d.height/d.my}).tension(.65).interpolate(this.line_interpolate),this.render(),$(a+" svg path").tipsy({gravity:"sw",html:!0,title:function(){var a=this.__data__,b=$.inArray(a,d.stream_data),c=0;return $.each(a,function(){c+=this.y}),d.label_names[b]+"<br />Total Exceptions: "+c}})},render:function(){var a=this;this.streams=this.vis.selectAll("path").data(this.stream_data).enter().append("svg:path").attr("d",this.area).attr("fill",function(b,c){return a.fill(a.aggregates[c]/a.max_aggregates)}).attr("fill-opacity",.7).attr("stroke","#EEE").on("mouseover",function(b,c){return a.mouseover(b,c)}).on("mouseout",function(b,c){return a.mouseout(b,c)}),this.grids=this.vis.selectAll("line").data(this.stream_data[0]).enter().append("svg:line").attr("class","grid").attr("x1",function(b,c){return c*a.width/a.mx}).attr("x2",function(b,c){return c*a.width/a.mx}).attr("y1",0).attr("y2",this.height).attr("stroke","none"),this.labels=this.vis.selectAll("text").data(this.label_names).enter().append("svg:text").attr("text-anchor","middle").attr("x",function(b,c){var d=Math.floor(a.stream_data[0].length/2)+c*(c%2>0?-1:1);return d*a.width/a.mx}).attr("y",function(b,c){var d=Math.floor(a.stream_data[0].length/2)+c*(c%2>0?-1:1),e=a.stream_data[c][d];return a.height-e.y0*a.height/a.my}).attr("fill","none").text(function(b,c){return a.label_names[c]})},mouseover:function(a,b){var c=this;this.hover_idx=b,this.labels.attr("fill","none"),this.vis.selectAll("path").attr("fill-opacity",function(a,b){return c.hover_idx==b?1:.1}).attr("stroke",function(a,b){return c.hover_idx==b?"#F64941":"none"}),this.grids.attr("stroke","#E3E3E3")},mouseout:function(){this.hover_idx=-1,this.vis.selectAll("text").attr("fill","none"),this.vis.selectAll("path").attr("fill-opacity",.7).attr("stroke","#EEE").attr("stroke-width",1),this.grids.attr("stroke","none"),this.labels.attr("fill","none")},transition:function(a,b){this.stream_data=d3.layout.stack().offset(a).order(b)(this.series),this.my=1.02*d3.max(this.stream_data,function(a){return d3.max(a,function(a){return a.y0+a.y})}),this.vis.selectAll("path").transition().delay(100).duration(1e3).attr("d",this.area)}});